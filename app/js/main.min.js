$(function(){var e=$(window),t=$(".page-top"),a=$("html, body"),l=($("#thanks"),$(".test")),d=6,c=parseGET();c&&0<Object.keys(c).length?window.sessionStorage.setItem("utms",JSON.stringify(c)):c=JSON.parse(window.sessionStorage.getItem("utms")||"[]"),e.scroll(function(){s()}),e.resize(function(){r()});var s=function(){e.scrollTop()>e.height()?t.addClass("active"):t.removeClass("active")};s();var r=function(){d=e.width()<580?2:e.width()<768?3:e.width()<992?4:e.width()<1200?5:6,setTimeout(function(){$(".present").equalHeights()},10)};r(),t.click(function(){a.stop().animate({scrollTop:0},"slow","swing")}),$(".test .button").click(function(){var e=$(this).closest(".test"),t=e.find("input:checked").length;if(e.hasClass("has-form")){var a=e.find(":required"),s=!0;if(a.each(function(){$elem=$(this),$elem.val()&&checkInput($elem)&&(!$elem.is(":checkbox")||$elem.is(":checked"))||($elem.addClass("error"),s=!1)}),s)if($(this).hasClass("form-submit")){var r=$(this).closest("form"),i=r.serialize();if(0<Object.keys(c).length)for(var n in c)i+="&"+n+"="+c[n];else i+="&utm=Прямой переход";$.ajax({type:"POST",url:"/mail.php",data:i}).done(function(){window.location="/result.html"}),a.removeClass("error"),r[0].reset()}else e.removeClass("active"),e.next().addClass("active")}else if(0<t){e.removeClass("has-error"),e.removeClass("active"),e.next().addClass("active");var o=l.index(e)+1;o<15&&($(".present-"+o).removeClass("last-active"),$(".present-"+(o+1)).addClass("last-active"),$(".present-"+(o+1)).addClass("active"),o%d==0&&m.trigger("to.owl.carousel",[o/d,200]))}else e.addClass("has-error");return!1});var i=$("#remodal-form");$("#remodal-form").submit(function(){if(0<Object.keys(c).length)for(var e in c)i.append("<input type='hidden' name='"+e+"' value='"+c[e]+"'>");else i.prepend("<input type='hidden' name='utm' value='Прямой переход'>")}),$(".phone").mask("+7 (999) 999 99 99",{completed:function(){$(this).removeClass("error")}}),$("input:required").keyup(function(){var e=$(this);e.hasClass("phone")||checkInput(e)});var m=$(".present-carousel");m.owlCarousel({items:1,nav:!1,dots:!0,loop:!1,smartSpeed:500,margin:0,navText:["",""],responsive:{0:{items:2},580:{items:3},768:{items:4},992:{items:5},1200:{items:6}}}),updateDate(),$(".birthday-year, .birthday-month").change(function(){setDays()}),$(".birthday-year, .birthday-day").change(function(){var e=$(this);e.val()&&e.removeClass("error")})});var months=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"];function updateDate(){var e=new Date,t=e.getFullYear();e.setMonth(e.getMonth()+1),$(".date-after-month").html(e.getDate()+" "+months[e.getMonth()]);for(var a="<option value=''>Год</option>",s=t;t-100<s;s--)a+="<option value='"+s+"'>"+s+"</option>";$(".birthday-year").html(a),setDays()}function setDays(){for(var e=+$(".birthday-year").val(),t=+$(".birthday-month").val(),a=+$(".birthday-day").val(),s=e?new Date(e,t,0).getDate():30,r="<option value=''>День</option>",i=1;i<=s;i++)r+="<option value='"+i+"'"+(a===i?" selected":"")+">"+i+"</option>";$(".birthday-day").html(r)}function validateEmail(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function checkInput(e){return!(!e.val()||"email"==e.attr("type")&&!validateEmail(e.val()))&&(e.removeClass("error"),!0)}function parseGET(e){var t=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];if(e&&""!=e||(e=decodeURI(document.location.search)),e.indexOf("?")<0)return Array();var a={},s=[],r=[];-1!=(e=(e=e.split("?"))[1]).indexOf("#")&&(e=e.substr(0,e.indexOf("#"))),-1<e.indexOf("&")?s=e.split("&"):s[0]=e;for(var i=0;i<s.length;i++)for(var n=0;n<t.length;n++)-1<s[i].indexOf(t[n]+"=")&&-1<s[i].indexOf("=")&&(a[(r=s[i].split("="))[0]]=r[1]);return a}