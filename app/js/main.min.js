$(function(){var e=$(window),t=$(".page-top"),a=$("html, body"),s=($("#thanks"),$(".test")),r=6,n=parseGET();n&&Object.keys(n).length>0?window.sessionStorage.setItem("utms",JSON.stringify(n)):n=JSON.parse(window.sessionStorage.getItem("utms")||"[]"),e.scroll(function(){i()}),e.resize(function(){o()});var i=function(){e.scrollTop()>e.height()?t.addClass("active"):t.removeClass("active")};i();var o=function(){r=e.width()<580?2:e.width()<768?3:e.width()<992?4:e.width()<1200?5:6,setTimeout(function(){$(".present").equalHeights()},10)};o(),t.click(function(){a.stop().animate({scrollTop:0},"slow","swing")}),$(".test .button").click(function(){var e=$(this).closest(".test"),t=e.find("input:checked").length;if(e.hasClass("has-form")){var a=e.find(":required"),i=!0;if(a.each(function(){$elem=$(this),$elem.val()&&checkInput($elem)||($elem.addClass("error"),i=!1)}),i)if($(this).hasClass("form-submit")){var o=$(this).closest("form"),l=o.serialize();if(Object.keys(n).length>0)for(var u in n)l+="&"+u+"="+n[u];else l+="&utm=Прямой переход";$.ajax({type:"POST",url:"/mail.php",data:l}).done(function(){}),a.removeClass("error"),o[0].reset()}else e.removeClass("active"),e.next().addClass("active")}else if(t>0){e.removeClass("has-error"),e.removeClass("active"),e.next().addClass("active");var m=s.index(e)+1;m<15&&($(".present-"+m).removeClass("last-active"),$(".present-"+(m+1)).addClass("last-active"),$(".present-"+(m+1)).addClass("active"),m%r==0&&d.trigger("to.owl.carousel",[m/r,200]))}else e.addClass("has-error");return!1});var l=$("#remodal-form");$("#remodal-form").submit(function(){if(Object.keys(n).length>0)for(var e in n)l.append("<input type='hidden' name='"+e+"' value='"+n[e]+"'>");else l.prepend("<input type='hidden' name='utm' value='Прямой переход'>")}),$(".phone").mask("+7 (999) 999 99 99",{completed:function(){$(this).removeClass("error")}}),$("input:required").keyup(function(){var e=$(this);e.hasClass("phone")||checkInput(e)});var d=$(".present-carousel");d.owlCarousel({items:1,nav:!1,dots:!0,loop:!1,smartSpeed:500,margin:0,navText:["",""],responsive:{0:{items:2},580:{items:3},768:{items:4},992:{items:5},1200:{items:6}}}),updateDate(),$(".birthday-year, .birthday-month").change(function(){setDays()}),$(".birthday-year, .birthday-day").change(function(){var e=$(this);e.val()&&e.removeClass("error")})});var months=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"];function updateDate(){var e=new Date,t=e.getFullYear();e.setMonth(e.getMonth()+1),$(".date-after-month").html(e.getDate()+" "+months[e.getMonth()]);for(var a="<option value=''>Год</option>",s=t;s>t-100;s--)a+="<option value='"+s+"'>"+s+"</option>";$(".birthday-year").html(a),setDays()}function setDays(){for(var e=+$(".birthday-year").val(),t=+$(".birthday-month").val(),a=+$(".birthday-day").val(),s=e?new Date(e,t,0).getDate():30,r="<option value=''>День</option>",n=1;n<=s;n++)r+="<option value='"+n+"'"+(a===n?" selected":"")+">"+n+"</option>";$(".birthday-day").html(r)}function validateEmail(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function checkInput(e){return!(!e.val()||(console.log("val",e.val()),"email"==e.attr("type")&&!validateEmail(e.val())))&&(e.removeClass("error"),!0)}function parseGET(e){var t=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];if(e&&""!=e||(e=decodeURI(document.location.search)),e.indexOf("?")<0)return Array();var a={},s=[],r=[];-1!=(e=(e=e.split("?"))[1]).indexOf("#")&&(e=e.substr(0,e.indexOf("#"))),e.indexOf("&")>-1?s=e.split("&"):s[0]=e;for(var n=0;n<s.length;n++)for(var i=0;i<t.length;i++)s[n].indexOf(t[i]+"=")>-1&&s[n].indexOf("=")>-1&&(a[(r=s[n].split("="))[0]]=r[1]);return a}